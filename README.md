# PanelMaster
Tools for creating precast in Revit 2019

![Интерфейс](/img/overview.png)

## Установка

Скопировать содержимое директории
> \\\ir-dsk\DNSDevelopment\1_ДСК Приморье\13. Проектный институт\ДНС ПРОЕКТ РАБОЧАЯ\BIM\00_DNSPanel\11_МастерПанелей\v2019

В директорию

> C:\Users\\{username}\AppData\Roaming\Autodesk\Revit\Addins\2019

***{username}** заменить на актуальное имя пользователя*

Запустить **Revit 2019**, при появлении окна выбрать опцию ***"Всегда разрешать"***

## Описание функций
Запуск процедур производится из вкладки "Мастер панелей" в ленте

![КЖ - LOD 100](/img/lod_100.png)

1. **Создание проекта КЖ**
   - [Создание проемов по файлу АР](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BF%D1%80%D0%BE%D0%B5%D0%BC%D1%8B)
   - [Создание марок изделия](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BC%D0%B0%D1%80%D0%BA%D0%B8)
   - [Создание сборок изделия](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%81%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8)
   - [Разборке сборок изделий](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%80%D0%B0%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8)

![КЖ - LOD 400](/img/lod_400.png)

2. **Создание проекта КЖ.И**
   - [Удаление уникальных сборок](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6%D0%B8---%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8)
   - [Создание чертежей изделий](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6%D0%B8---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D1%87%D0%B5%D1%80%D1%82%D0%B5%D0%B6%D0%B8-%D0%BA%D0%B6%D0%B8)

![АКР](/img/arch.png)

3. **Создание проекта АР и АКР**
   - [Создание проемов по файлу КР](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BF%D1%80%D0%BE%D0%B5%D0%BC%D1%8B)
   - [Создание плитки](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BF%D0%BB%D0%B8%D1%82%D0%BA%D1%83)
   - [Создание марок фасадов (по материалам плитки и файлу КР)](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-%D0%BC%D0%B0%D1%80%D0%BA%D0%B8)
   - [Создание чертежей фасадов](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D1%87%D0%B5%D1%80%D1%82%D0%B5%D0%B6%D0%B8)

![АКР](/img/settings.png)

4. **Задания настроек**
   - Правило выбора элементов
   - Способ раскладки плитки
   - Габариты плитки

## Перед началом
1. Убедитесь, что работаете в файле один
2. Если в проекте включена совместная работа:
   2.1. Перед выполнением процедуры, убедитесь, что все рабочие наборы свободны
   2.2. В процессе выполнения, каждая процедура занимает **все** рабочие наборы, существующие в проекте.
   2.3. После выполнения процедуры, необходимо вручную освободить все рабочие наборы. (см п. 2.1.)
3. Для обработки модели **не рекомендуется** использовать выбор всех элементов, кроме операции присвоения марок (см. Настройки)
4. Лучшей практикой для обработки модели является подготовка отдельного вида для категории панелей (НС, ВС, ПП и т.д) с настроенной фильтрацией.
5. При создании чертежей, убедитесь, что в проекте имеются необходимые шаблоны (см. [Создание чертежей изделий](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6%D0%B8---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D1%87%D0%B5%D1%80%D1%82%D0%B5%D0%B6%D0%B8-%D0%BA%D0%B6%D0%B8) )
6. При обнаружении неожиданных ошибок или багов обращаться лично :)
7. Предложения по улучшению и доработке можно отправлять на почту: shevyakov.a@dnsgroup.ru или высказывать лично :)

## Предлагаемая процедура обработки модели
### КЖ
1. Разместить семейства панелей LOD100 в соответствующем файле КЖ по архитектурной подложке
2. Очистить значения марок для панелей скопированных из существующих проектов
3. Для новых панелей создать проемы специальной функцией (см [Создание проемов по файлу АР](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BF%D1%80%D0%BE%D0%B5%D0%BC%D1%8B))
4. Создать марки изделий (см [Создание марок изделия](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BC%D0%B0%D1%80%D0%BA%D0%B8))
5. Вручную проанализировать повторяющиеся изделия.
6. Назначить изделиям индексы (параметр **"ADSK_Номер_изделия"**) и очистить значения марок изделия
7. Заново создать марки изделий

### КЖ.И
1. Для нужного раздела (КЖ.И1 - КЖ.И7) создать отдельный файл путем отсоединения модели КЖ от центрального файла и сохранением
2. В модели раздела КЖ.И удалить ненужные элементы (заливка швов, армирование и т.п)
3. Создать сборки для требуемых элементов (см [Создание сборок изделия](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6---%D1%81%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8)) 
4. Удалить повторяющиеся сборки и произвести проверку модели (см [Удаление уникальных сборок](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6%D0%B8---%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8))
5. Создать чертежи КЖ.И (см [Создание чертежей изделий](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%BA%D0%B6%D0%B8---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D1%87%D0%B5%D1%80%D1%82%D0%B5%D0%B6%D0%B8-%D0%BA%D0%B6%D0%B8))

### АКР
1. Существующую подложку КЖ обрисовать стеной "DNS_Фасад" или "DNS_Фасад2" (осевой линией по внешнему контуру панелей между красными засечками. Красная сторона фасада должна находиться снаружи)
2. Создать проемы для модели (см [Создание проемов по файлу КР](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BF%D1%80%D0%BE%D0%B5%D0%BC%D1%8B) )
3. Создать плитку (см [Создание плитки](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BF%D0%BB%D0%B8%D1%82%D0%BA%D1%83))
4. Скопировать марки из подложки КЖ (см [Создание марок фасадов (по материалам плитки и файлу КР)](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-%D0%BC%D0%B0%D1%80%D0%BA%D0%B8))
5. Создать чертежи АКР (см [[Создание чертежей фасадов](https://github.com/shev7avl/PanelMaster/blob/main/README.md#%D0%B0%D0%BA%D1%80---%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D1%87%D0%B5%D1%80%D1%82%D0%B5%D0%B6%D0%B8)])

## Работа процедур
### КЖ - Создать проемы
*Принцип работы: собирает коллекцию подгруженных АР подложек (**Важно:** файлы АР должны быть подгружены напрямую и содержать подстроку "_АР" в названии).*

*Для каждой выбранной панели типа НС или ВС ищет список окон, пересекающих BoundingBox панели (категория: Окна, имя содержит "DNS_").*

*Если список пустой, то ищет список дверей, пересекающих BoundingBox панели (категория: Двери, имя не содержит "стекл").*

*Длина списка 0 <= n <= 2; при n>2 последний элемент отбрасывается (В семействах панелей не заложено создание 3 отверстия).*

***Если панель пересекает И дверь (категория: дверь) И окно (категория: окно), то будет создан проем только для окна. Это - ошибка, которая будет устранена***

*Из списка окон/дверей считываются системные параметры высоты и ширины. Они копируются в значения параметров панели с учётом модуля 300мм, шага плитки 12мм, и смещения уровня -80мм. На данный момент не предусмотрено изменение этих параметров.*

### КЖ - Создать марки
*Принцип работы: собирает коллекцию панелей*

*Для каждой выбранной панели проверяет создает значения параметров **"DNS_Полная_марка_изделия"**, **"ADSK_Марка_изделия"** и считывает параметр **"ADSK_Номер_изделия"**.*

*Если **"ADSK_Номер_изделия"** пустой, то создаёт индекс вида "ID{element.Id}"*

*Для корректного назначения марок необходимо вручную проставить индексы в **"ADSK_Номер_изделия"**, очистить параметры **"DNS_Полная_марка_изделия"** и **"ADSK_Марка_изделия"** и выполнить процедуру заново*

*В будущем выбор переписывать или нет значения марок будет добавлен в настройки*

### КЖ - Собрать сборки
*Принцип работы: Для выбранного набора панелей. В сборку включаются все вложенные семейства. Для панелей ВС и НС предусмотрена передача стыковочных стержней по вертикали и попадающие торцевые ПВЛ*
*При включенной опции "Выбрать все" в настройках использовать с осторожностью*

***Функция работает нестабильно: некоторые элементы могут не попадать в сборку, или, напротив - могут попадать лишние элементы.***
*В данный момент, не ведется работа по исправлению ошибок этой функции, для создания сборок рекомендуется использовать процедуру от BIM2B*

### КЖ - Разобрать сборки
*Разбирает выбранные сборки для панелей.*
*Если при этом удаляется последний тип сборки - выбрасывает предупреждение*
*При включенной опции "Выбрать все" в настройках использовать с осторожностью*

### КЖ.И - Оставить уникальные сборки
*Для выбранных панелей оставляет по 1 экземпляру каждой сборки.При этом экземпляры **не разбираются**, а **полностью удаляются** из проекта*

### КЖ.И - Создать чертежи КЖ.И
*Для выбранных сборок создает комплект чертежей в соответствии со внутренними требованиями по оформлению чертежей КЖ.И. Если в проекте отсутствуют необходимые шаблоны видов или виды(чертежные виды, легенды), они не будут размещены.*
*Ознакомиться со списком ожидаемых видов можно в файле [ViewTemplateNames.cs](https://github.com/shev7avl/PanelMaster/blob/main/ViewTemplateNames.cs)*

*В дальнейшем предполагается проводить проверку на наличие видов в проекте с формированием отчета*

### АКР - Скопировать марки
*Принцип работы: Собирает коллекцию связей КР (**Важно:** файлы КР должны быть подгружены напрямую и содержать подстроку "_КР" ил "_КЖ" в названии).*

*Для каждой стены фасада ищет панель из связи, пересекающую BoundingBox стены. Из пересекающегося элемента копирует значения параметров:*

1. DNS_Полная_марка_изделия
2. ADSK_Марка_изделия
3. DNS_Марка_элемента

*Копирует значения параметров в фасад*

***Процедура работает неэффективно, в будущем будет подвергнута оптимизации и рефакторингу***

### АКР - Создать проемы
*Принцип работы: Собирает коллекцию связей КР (**Важно:** файлы КР должны быть подгружены напрямую и содержать подстроку "_КР" ил "_КЖ" в названии).*

*Для каждой стены фасада ищет панель из связи, пересекающую BoundingBox стены. В пересекающихся панелях ищет значения параметров отвечающих за отверстия.*
*По значениям полученных параметров рассчитывает точку вставки и габариты проема. Размещает экземпляр семейства "DNS_ПроемДляПлитки" с заданными параметрами.*

***Важно:** Для корректного размещения стена типа "DNS_Фасад" или "DNS_Фасад2" должна быть размещена **"по линии сердцевины"** красным наружу*.

***Важно:** Создание проемов для торцевых элементов фасада будет закончено с ошибкой "Не удалось создать элемент выдавливания"*.

***Важно:** Габариты проема задаются с учетом габаритов плитки заданных в настройках. В модулях КЖ на данный момент заложены габариты 288мм х 88мм х 12мм. При отличающихся габаритах в настройках в проекте АКР могут быть некорректно размещены проемы.*
*Это - ошибка, которая будет устранена*

### АКР - Создать плитку

*Разрезает элемент фасада на прямоугольные части - плитки. Габарит плитки можно задать в **Настройках** -> **Габариты плитки***.

***Важно:** Для корректного создания плитки стена типа "DNS_Фасад" или "DNS_Фасад2" должна быть размещена **"по линии сердцевины"** красным наружу*.

***Важно:** Если длина стены не кратна модулю (Длина+Шов/2) процедура может завершаться с ошибкой*.

***Важно:** Габариты плитки задаются без учета толщины шва. В модулях КЖ на данный момент заложены габариты 288мм х 88мм х 12мм. При отличающихся габаритах в проекте АКР могут быть некорректно размещены проемы.*

### АКР - Создать чертежи

*Создает сборки фасадов и создает для них чертежи АКР в соответствии со внутренними требованиями по оформлению чертежей АКР. Если в проекте отсутствуют необходимые шаблоны видов или виды(чертежные виды, легенды), они не будут размещены.*
*Ознакомиться со списком ожидаемых видов можно в файле [ViewTemplateNames.cs](https://github.com/shev7avl/PanelMaster/blob/main/ViewTemplateNames.cs)*

*В дальнейшем предполагается проводить проверку на наличие видов в проекте с формированием отчета*

***Важно:** Функция не была адекватно протестирована, за исправлением ошибок обращаться ко мне*.
